<!DOCTYPE html>
<html>
    <head>
        <title>Counter</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <meta name="author" content="samely" />
        <link rel="stylesheet" type="text/css" href="css/style.css" /> 
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

        <script>
            //Fill date data
            $(function () {
                $('#txtFromDate').datepicker({
                    dateFormat: 'yy-mm-dd',
                    inline: true,
                    onSelect: function () {
                        var fromDate = $(this).datepicker('getDate');
                        var fromDayVar = fromDate.getUTCDate();
                        //document.getElementById('fromDay').innerHTML = "</br> from day: " + fromDayVar + "</br>";
                    }
                });
                $('#txtDateTo').datepicker({dateFormat: 'yy-mm-dd',
                    inline: true,
                    onSelect: function () {
                        var toDate = $(this).datepicker('getDate');
                        var toDayVar = toDate.getUTCDate();
                        //document.getElementById('toDay').innerHTML = "</br> to day: " + toDayVar + "</br>";
                    }
                });
            });
        </script>

        <script>
            function count() {
                var comment = null;
                var user = null;
                var fromDate = null;
                var toDate = null;
                var url = null;
                comment = document.getElementById('txtComment').value;
                user = document.getElementById('txtUser').value;
                fromDate = document.getElementById('txtFromDate').value;
                toDate = document.getElementById('txtDateTo').value;

                var listUrl = [];
                var test = "";

                //url:https://api.openstreetmap.org/api/0.6/changesets?display_name=samely&time=2016-05-02T17:50:00Z,2016-05-02T18:00:00Z
                for (minute = 0; minute < 59; minute++) {
                    if (minute===15||minute===30||minute===45){
                        url = "https://api.openstreetmap.org/api/0.6/changesets?display_name=" + user + "&time=" +
                                fromDate + "T18:" + ("0" + minute).slice(-2) + ":00Z," +
                                toDate + "T18:" + ("0" + (minute + 1)).slice(-2) + ":59Z";
                        listUrl.push(url);
                        test = test.concat(url);
                        if (minute === 45) {
                            url = "https://api.openstreetmap.org/api/0.6/changesets?display_name=" + user + "&time=" +
                                    fromDate + "T18:45:00Z," + toDate + "T18:59:59Z";
                            listUrl.push(url);
                            test = test.concat(url);
                        }
                    }
                }

                document.getElementById('printURL').innerHTML = "</br> URL: " + test + "</br>";
                /*
                 var c = 0;
                 var listId = [];
                 var child = "";
                 
                 for (u = 0; u < listUrl.length; u++) {
                 
                 var m, i, y, xmlDoc;
                 var x = new XMLHttpRequest();
                 x.open("GET", listUrl[u], false);
                 
                 x.onreadystatechange = function () {
                 if (x.readyState == 4 && x.status == 200) {
                 xmlDoc = x.responseXML;
                 m = xmlDoc.getElementsByTagName('tag');
                 
                 for (i = 0; i < m.length; i++) {
                 if (m[i].getAttribute('k') === 'comment') {
                 if (m[i].getAttribute('v').includes(comment)) {
                 listId.push(m[i].parentNode.getAttribute('id'));
                 child = child.concat(m[i].parentNode.getAttribute('id'));
                 c++;
                 }
                 }
                 }
                 }
                 };
                 x.send();
                 }
                 
                 function remove_duplicates_safe(arr) {
                 var obj = {};
                 var arr2 = [];
                 for (var i = 0; i < arr.length; i++) {
                 if (!(arr[i] in obj)) {
                 arr2.push(arr[i]);
                 obj[arr[i]] = true;
                 }
                 }
                 return arr2;
                 }
                 var num = remove_duplicates_safe(listId).length;
                 
                 document.getElementById('countingInfo').innerHTML = "</br> Number of changesets: " + num + "</br>";
                 */
            }
        </script>    
    </head>
    <body> 
        <header><h1>Changeset Comment Counter</h1></header>
        <div>
            <form>
                <p>
                    <label >From Date:</label> 
                    <input  type="text" id="txtFromDate" name="txtFromDate" required="required" placeholder="yy-mm-dd"/>    
                </p>
                <p>
                    <label >To Date:</label> 
                    <input  type="text" id="txtDateTo" name="txtDateTo" required="required"  placeholder="yy-mm-dd">   
                </p>
                <p>
                    <label >User:</label> 
                    <input type="text" id="txtUser" name="txtUser" required placeholder="User"/>
                </p>
                <p>
                    <label >Comment:</label> 
                    <input type="text" id="txtComment" name="txtComment" required placeholder="Comment for searching"/>
                </p>
            </form>

            <p> 
                <button type="button" id="btnCount" onclick="count()">Count!</button>
            </p>
            <div id="countingInfo"></div>
            <div id="printURL"></div>
            <div id="Totalcount"></div>
            <div id="TotalPerDay"></div>  
            <div id="fromDay"></div>  
            <div id="toDay"></div> 
            <div id="tryIterator"></div> 

        </div>


    </body>
</html>
